<%= form_for @order, :url => update_checkout_path('complete'), :html => { :id => "checkout_form_#{@order.state}" } do |form| %>
  <div class="columns alpha six" data-hook="billing_fieldset_wrapper">
    <fieldset id="billing" data-hook>
      <%= form.fields_for :bill_address do |bill_form| %>
        <legend align="center"><%= t(:billing_address) %></legend>
        <%= render :partial => 'spree/address/form', :locals => {:form => bill_form, :address_type => 'billing', :address => @order.bill_address} %>
      <% end %>
    </fieldset>
  </div>

  <div class="columns omega twelve" data-hook="shipping_fieldset_wrapper">
    <fieldset id="shipping" data-hook>
      <%= form.fields_for :ship_address do |ship_form| %>
        <legend align="center"><%= t(:shipping_address) %></legend>
        <p class="field checkbox" data-hook="use_billing">
          <%= check_box_tag 'order[use_billing]', '1', ((@order.bill_address.empty? && @order.ship_address.empty?) || @order.bill_address.same_as?(@order.ship_address)) %>
          <%= label_tag :order_use_billing, t(:use_billing_address), :id => 'use_billing' %>
        </p>
        <%= render :partial => 'spree/address/form', :locals => {:form => ship_form, :address_type => 'shipping', :address => @order.ship_address} %>
      <% end %>
    </fieldset>
  </div>

  <div class='columns four alpha' data-hook='delivery_fieldset_wrapper' >
    <fieldset id='shipping_method' class='clear-checkout variant-info' "data-hook"="">
      <h4>Способы доставки</h4>
      <div id='methods'>
        <p class='field radios'>
          <% @order.rate_hash.each do |shipping_method| %>
            <label>
              <%= radio_button(:order, :shipping_method_id, shipping_method[:id]) %>
              <%= shipping_method.name %>
              <%= number_to_currency shipping_method.cost, :precision => 0 %>
            </label>
          <% end %>
        </p>
      </div>
      <% if Spree::Config[:shipping_instructions] && @order.rate_hash.present? %>
        <p id='minstrs' "data-hook"="">
          <%= form.label :special_instructions, t(:shipping_instructions) %>
          <br>
          <%= form.text_area :special_instructions, :cols => 40, :rows => 7 %>
      <% end %>
    </fieldset>
  </div>

  <div class 'omega twelve columns' >
    <fieldset id="payment" class="variant-info" "data-hook"="">
      <h4><%= t(:payment_information) %>
      <div "data-hook"="checkout_payment_step">
        <% @order.available_payment_methods.each do |method| %>
          <p>
            <label>
              <%= radio_button_tag "order[payments_attributes][][payment_method_id]", method.id, method == @order.payment_method %>
              <%= t(method.name, :scope => :payment_methods, :default => method.name) %>
            </label>
          </p>
        <% end %>
        <ul id="payment-methods" "data-hook"="">
          <% @order.available_payment_methods.each do |method| %>
            <li class='last' "data-hook"="" id="payment_method_<%=method.id%>">
              <fieldset>
                <%= render :partial => "spree/checkout/payment/#{method.method_type}", :locals => { :payment_method => method } %>
              </fieldset>
            </li>
          <% end %>
        </ul>
        <br style="clear:both;">
        <div "data-hook"=""></div>
      </div>
    </fieldset>
  </div>

  <br class="space">
  <div class="form-buttons" "data-hook"="buttons">
    <%= submit_tag t(:checkout), :class => 'btn' %>
  </div>
<% end %>
